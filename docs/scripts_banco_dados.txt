CREATE DATABASE 'localhost:C:\ProjetosPaulo\ProjetoControleNegociacao\data\PROJETODELPHI.FDB.fdb'
USER 'SYSDBA' PASSWORD 'masterkey'
PAGE_SIZE 8192 DEFAULT CHARACTER SET UTF8;

CONNECT "C:\ProjetosPaulo\ProjetoControleNegociacao\data\PROJETODELPHI.FDB"
user 'SYSDBA' password 'masterkey';


CREATE GENERATOR GEN_CODPRODUTO;

CREATE TABLE TBL_PRODUTO (
  CODPRODUTO INTEGER NOT NULL,
  NOMEPRODUTO VARCHAR(100) NOT NULL,
  PRECOVENDAPRODUTO NUMERIC(15,2) NOT NULL,
  CONSTRAINT PK_TBL_PRODUTO PRIMARY KEY (CODPRODUTO)
);


CREATE GENERATOR GEN_CODDISTRIBUIDOR;

CREATE TABLE TBL_DISTRIBUIDOR (
  CODDISTRIBUIDOR INTEGER NOT NULL,
  NOMEDISTRIBUIDOR VARCHAR(100) NOT NULL,
  CNPJ VARCHAR(14) NOT NULL,
  CONSTRAINT PK_TBL_DISTRIBUIDOR PRIMARY KEY (CODDISTRIBUIDOR)
);

CREATE GENERATOR GEN_CODPRODUTOR;

CREATE TABLE TBL_PRODUTOR(
  CODPRODUTOR INTEGER NOT NULL, 
  NOMEPRODUTOR VARCHAR(100) NOT NULL,   
  CPF_CNPJ VARCHAR(14) NOT NULL,
  CONSTRAINT PK_TBL_PRODUTOR PRIMARY KEY (CODPRODUTOR)
);  

CREATE TABLE TBL_LIMITE_CREDITO(
  CODPRODUTOR INTEGER NOT NULL,  
  CODDISTRIBUIDOR INTEGER NOT NULL,  
  LIMITE_CREDITO NUMERIC(15,2) NOT NULL,
  CONSTRAINT PK_TBL_LIMITE_CREDITO PRIMARY KEY (CODPRODUTOR,CODDISTRIBUIDOR)  
  );


ALTER TABLE TBL_LIMITE_CREDITO ADD CONSTRAINT FK_TBL_PRODUTOR FOREIGN KEY (CODPRODUTOR) REFERENCES TBL_PRODUTOR(CODPRODUTOR);

ALTER TABLE TBL_LIMITE_CREDITO ADD CONSTRAINT FK_TBL_DISTRIBUIDOR FOREIGN KEY (CODDISTRIBUIDOR) REFERENCES TBL_DISTRIBUIDOR(CODDISTRIBUIDOR);

CREATE GENERATOR GEN_IDNEGOCIACAO;

CREATE TABLE TBL_NEGOCIACAO(
  IDNEGOCIACAO INTEGER NOT NULL,  
  CODPRODUTOR INTEGER NOT NULL,  
  CODDISTRIBUIDOR INTEGER NOT NULL,    
  STATUS VARCHAR(2) NOT NULL CHECK (STATUS IN ('PE', 'AP', 'CO', 'CA')), 
  DATA_NEGOCIACAO DATE NOT NULL,
  CONSTRAINT PK_TBL_NEGOCIACAO PRIMARY KEY (IDNEGOCIACAO)  
  );

ALTER TABLE TBL_NEGOCIACAO ADD CONSTRAINT FK2_TBL_PRODUTOR FOREIGN KEY (CODPRODUTOR) REFERENCES TBL_PRODUTOR(CODPRODUTOR);

ALTER TABLE TBL_NEGOCIACAO ADD CONSTRAINT FK2_TBL_DISTRIBUIDOR FOREIGN KEY (CODDISTRIBUIDOR) REFERENCES TBL_DISTRIBUIDOR(CODDISTRIBUIDOR);

CREATE TABLE TBL_NEGOCIACAO_ITENS(
  IDNEGOCIACAO INTEGER NOT NULL,  
  CODPRODUTO INTEGER NOT NULL,
  QUANTIDADE INTEGER NOT NULL
);  

ALTER TABLE TBL_NEGOCIACAO_ITENS ADD CONSTRAINT FK_TBL_NEGOCIACAO FOREIGN KEY (IDNEGOCIACAO) REFERENCES TBL_NEGOCIACAO(IDNEGOCIACAO);

ALTER TABLE TBL_NEGOCIACAO_ITENS ADD CONSTRAINT FK_TBL_PRODUTO FOREIGN KEY (CODPRODUTO) REFERENCES TBL_PRODUTO(CODPRODUTO);